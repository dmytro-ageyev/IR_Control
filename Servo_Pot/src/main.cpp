/**
 * @file Servo_Pot.ino
 * @brief –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–æ–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–∞ –∑ –≤—ñ–∑—É–∞–ª—å–Ω–∏–º —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º —É Serial Monitor.
 *
 * –¶—è –ø—Ä–æ–≥—Ä–∞–º–∞ –∑—á–∏—Ç—É—î –∞–Ω–∞–ª–æ–≥–æ–≤–∏–π —Å–∏–≥–Ω–∞–ª –∑ –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–∞, –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ–≥–æ –¥–æ –≤—Ö–æ–¥—É A0, 
 * –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –π–æ–≥–æ —É –∑–Ω–∞—á–µ–Ω–Ω—è –∫—É—Ç–∞ –≤ –¥—ñ–∞–ø–∞–∑–æ–Ω—ñ 0‚Äì180¬∞ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Å–µ—Ä–≤–æ–ø—Ä–∏–≤—ñ–¥ 
 * —É –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –ø–æ–ª–æ–∂–µ–Ω–Ω—è. –í–∏–≤—ñ–¥ —É –º–æ–Ω—ñ—Ç–æ—Ä –ø–æ—Ä—Ç—É –∑–¥—ñ–π—Å–Ω—é—î—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫—É—Ç–∞ 
 * –±—ñ–ª—å—à –Ω—ñ–∂ –Ω–∞ 5¬∞, —â–æ –¥–æ–∑–≤–æ–ª—è—î —É–Ω–∏–∫–Ω—É—Ç–∏ –Ω–∞–¥–º—ñ—Ä–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –µ–∫—Ä–∞–Ω–∞.
 *
 * –î–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –≤–∏–≤–æ–¥–∏—Ç—å—Å—è "–≥—Ä–∞—Ñ—ñ—á–Ω–∏–π" —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ—Ç–æ—á–Ω–æ–≥–æ –∫—É—Ç–∞ —É –≤–∏–≥–ª—è–¥—ñ —à–∫–∞–ª–∏,
 * —â–æ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–∑—É–∞–ª—å–Ω–æ –æ—Ü—ñ–Ω–∏—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É.
 *
 * --- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è ---
 *  –ü–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä:
 *    - –õ—ñ–≤–∏–π –∫–æ–Ω—Ç–∞–∫—Ç  ‚Üí GND
 *    - –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∏–π –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí A0
 *    - –ü—Ä–∞–≤–∏–π –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí 5V
 *
 *  –°–µ—Ä–≤–æ–ø—Ä–∏–≤—ñ–¥:
 *    - –ü–æ–º–∞—Ä–∞–Ω—á–µ–≤–∏–π (—Å–∏–≥–Ω–∞–ª) ‚Üí D11
 *    - –ß–µ—Ä–≤–æ–Ω–∏–π (–∂–∏–≤–ª–µ–Ω–Ω—è) ‚Üí 5V
 *    - –ö–æ—Ä–∏—á–Ω–µ–≤–∏–π (–∑–µ–º–ª—è) ‚Üí GND
 *
 * --- –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ ---
 *  - Servo.h  (–≤—Ö–æ–¥–∏—Ç—å –¥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—ó –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Arduino IDE)
 *
 * --- –ê–≤—Ç–æ—Ä ---
 *  @author  –î–º–∏—Ç—Ä–æ –ê–≥–µ—î–≤
 *  @date    08.10.2025
 *  @license MIT
 */

#include <Arduino.h>  // –û—Å–Ω–æ–≤–Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞ Arduino
#include <Servo.h>    // –ö–ª–∞—Å –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–∞–º–∏

// ----------------------------------------------------------
//               –ì–ª–æ–±–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∏ —Ç–∞ –∑–º—ñ–Ω–Ω—ñ
// ----------------------------------------------------------

/**
 * @brief –ü—ñ–Ω, –¥–æ —è–∫–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä.
 */
const int POT_PIN = A0;

/**
 * @brief –ü—ñ–Ω –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–æ–º.
 */
const int SERVO_PIN = 11;

/**
 * @brief –ú–µ–∂—ñ —Ä—É—Ö—É —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É (—É –≥—Ä–∞–¥—É—Å–∞—Ö).
 */
const int MIN_ANGLE = 0;
const int MAX_ANGLE = 180;

/**
 * @brief –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–∞ –∫—É—Ç–∞, –∑–∞ —è–∫–æ—ó –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤–∏–≤—ñ–¥ —É –º–æ–Ω—ñ—Ç–æ—Ä.
 */
const int ANGLE_TOLERANCE = 5;

/**
 * @brief –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ –∑–º—ñ–Ω–∞ –∫—É—Ç–∞, –∑–∞ —è–∫–æ—ó –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –≤–∏–≤—ñ–¥ —É –º–æ–Ω—ñ—Ç–æ—Ä.
 */
const int MAX_SEGMENT = (MAX_ANGLE - MIN_ANGLE) / ANGLE_TOLERANCE;

Servo myServo;        ///< –û–±‚Äô—î–∫—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É
int lastAngle = -1;   ///< –ó–±–µ—Ä–µ–∂–µ–Ω–∏–π –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∫—É—Ç –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∑–º—ñ–Ω

// ----------------------------------------------------------
//                   –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
// ----------------------------------------------------------

/**
 * @brief –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Serial Monitor —Ç–∞ —Å–µ—Ä–≤–æ.
 *
 * –í—Å—Ç–∞–Ω–æ–≤–ª—é—î —à–≤–∏–¥–∫—ñ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á—ñ –¥–∞–Ω–∏—Ö 9600 –±–æ–¥,
 * –ø—Ä–∏—î–¥–Ω—É—î —Å–µ—Ä–≤–æ–ø—Ä–∏–≤—ñ–¥ –¥–æ –≤–∫–∞–∑–∞–Ω–æ–≥–æ –ø—ñ–Ω–∞
 * —Ç–∞ –≤–∏–≤–æ–¥–∏—Ç—å –∫–æ—Ä–æ—Ç–∫—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞.
 */
void setup() {
  Serial.begin(9600);
  myServo.attach(SERVO_PIN);

  Serial.println("====================================================");
  Serial.println(" üß≠  –°–∏—Å—Ç–µ–º–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥–æ–º –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–æ–º ");
  Serial.println("====================================================");
  Serial.println("–ü–æ–≤–µ—Ä–Ω—ñ—Ç—å —Ä—É—á–∫—É –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–∞, —â–æ–± –∑–º—ñ–Ω–∏—Ç–∏ –∫—É—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É.");
  Serial.println("–î–∞–Ω—ñ –æ–Ω–æ–≤–ª—é—é—Ç—å—Å—è –ª–∏—à–µ –ø—Ä–∏ –∑–º—ñ–Ω—ñ –∫—É—Ç–∞ –±—ñ–ª—å—à–µ –Ω—ñ–∂ –Ω–∞ 5¬∞.\n");
  delay(1000);
}

// ----------------------------------------------------------
//                –î–û–ü–û–ú–Ü–ñ–ù–ê –§–£–ù–ö–¶–Ü–Ø –í–ò–í–û–î–£
// ----------------------------------------------------------

/**
 * @brief –í–∏–≤–æ–¥–∏—Ç—å –ø–æ—Ç–æ—á–Ω–∏–π –∫—É—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É —É Serial Monitor —É –≥—Ä–∞—Ñ—ñ—á–Ω–æ–º—É –≤–∏–≥–ª—è–¥—ñ.
 *
 * –¶—è —Ñ—É–Ω–∫—Ü—ñ—è —Å—Ç–≤–æ—Ä—é—î —à–∫–∞–ª—É –∑ MAX_SEGMENT —Å–µ–≥–º–µ–Ω—Ç—ñ–≤, —è–∫–∞ –ø–æ–∫–∞–∑—É—î –ø–æ—Ç–æ—á–Ω–µ –ø–æ–ª–æ–∂–µ–Ω–Ω—è
 * —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É. –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∫—É—Ç—É –ø–æ–≤–æ—Ä–æ—Ç—É.
 *
 * @param angle –ü–æ—Ç–æ—á–Ω–∏–π –∫—É—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É (0‚Äì180¬∞).
 */
void PrintAngleChange(int angle) {
  // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–∏—à–µ –ø—Ä–∏ –∑–Ω–∞—á–Ω—ñ–π –∑–º—ñ–Ω—ñ
  if (abs(angle - lastAngle) >= ANGLE_TOLERANCE) {
        lastAngle = angle;        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è
        Serial.print("–ö—É—Ç: ");
        Serial.print(angle);
        Serial.print("¬∞ \t[");

  // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–æ–≤–Ω–µ–Ω–∏—Ö —Å–µ–≥–º–µ–Ω—Ç—ñ–≤
        int filled = map(angle, MIN_ANGLE, MAX_ANGLE, 0, MAX_SEGMENT);
        for (int i = 0; i < MAX_SEGMENT; i++) {
          if (i < filled) Serial.print("#");
          else Serial.print("-");
        }

        Serial.println("]");
      }
}

// ----------------------------------------------------------
//                     –û–°–ù–û–í–ù–ò–ô –¶–ò–ö–õ
// ----------------------------------------------------------

/**
 * @brief –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª –ø—Ä–æ–≥—Ä–∞–º–∏.
 *
 * –£ –∫–æ–∂–Ω—ñ–π —ñ—Ç–µ—Ä–∞—Ü—ñ—ó –ø—Ä–æ–≥—Ä–∞–º–∞ –∑—á–∏—Ç—É—î –ø–æ—Ç–æ—á–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–∞,
 * –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î –π–æ–≥–æ —É –∫—É—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É, —ñ —è–∫—â–æ –∑–º—ñ–Ω–∞ –ø–µ—Ä–µ–≤–∏—â—É—î –ø–æ—Ä—ñ–≥,
 * –æ–Ω–æ–≤–ª—é—î –ø–æ–ª–æ–∂–µ–Ω–Ω—è —Å–µ—Ä–≤–æ —Ç–∞ –≤–∏–≤—ñ–¥ —É –º–æ–Ω—ñ—Ç–æ—Ä –ø–æ—Ä—Ç—É.
 */
void loop() {
  // –ó—á–∏—Ç—É–≤–∞–Ω–Ω—è –∞–Ω–∞–ª–æ–≥–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª—É –∑ –ø–æ—Ç–µ–Ω—Ü—ñ–æ–º–µ—Ç—Ä–∞
  int potValue = analogRead(POT_PIN);

  // –ü–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–∏–≥–Ω–∞–ª—É –≤ –∫—É—Ç —Å–µ—Ä–≤–æ–ø—Ä–∏–≤–æ–¥—É
  int angle = map(potValue, 0, 1023, MIN_ANGLE, MAX_ANGLE);

  myServo.write(angle);     // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∫—É—Ç–∞
  PrintAngleChange(angle);  // –í–∏–≤—ñ–¥ —É –º–æ–Ω—ñ—Ç–æ—Ä –ø–æ—Ä—Ç—É

  delay(50); // –ù–µ–≤–µ–ª–∏–∫–∞ –ø–∞—É–∑–∞ –¥–ª—è —Å—Ç–∞–±—ñ–ª—å–Ω–æ—Å—Ç—ñ
}
